<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f4f4f9;
    }

    .profile-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .profile-container h1 {
        text-align: center;
        margin-bottom: 20px;
    }

    .profile-container p {
        font-size: 16px;
        line-height: 1.6;
    }

    .profile-container .profile-info {
        margin: 10px 0;
    }

    .profile-container .profile-info strong {
        display: inline-block;
        width: 120px;
    }

    .profile-container .profile-image {
        display: block;
        max-width: 150px;
        margin: 0 auto 20px;
        border-radius: 50%;
    }

    .loading {
        text-align: center;
        font-size: 18px;
        color: #555;
    }
</style>

<div class="profile-container mt-5">
    <h1>내 프로필</h1>
    <div class="loading">로딩 중...</div>
    <div class="profile-image">
        <img id="profile-image" src="" alt="프로필 이미지" style="width: 10vw;" />
    </div>
    <div class="profile-info">
        <p><strong>사용자명:</strong> <span id="username"></span></p>
        <p><strong>이메일:</strong> <span id="email"></span></p>
        <p><strong>자기소개:</strong> <span id="introduction"></span></p>
        <p>비밀번호 변경</p>
        <p>회원수정</p>
        <p>회원 탈퇴</p>
    </div>
</div>

<script>
    // 디버그 메시지를 화면에 출력하는 함수
    const debugMessage = (message) => {
        const div = document.createElement("div");
        
        // 고유한 ID를 생성하기 위해 Date.now()를 사용
        div.id = "debug-message-" + Date.now(); 

        div.style.position = "fixed";
        div.style.top = "10px"; // 위에서부터 차례대로 표시되게 하려면 top을 고정
        div.style.left = "50%"; // 화면 가운데 정렬
        div.style.transform = "translateX(-50%)"; // 가로 중앙 정렬
        div.style.width = "100%"; // 넓이를 100%로 설정하여, 너무 길게 표시되지 않도록 함
        div.style.backgroundColor = "rgba(0, 0, 0, 0.2)";
        div.style.color = "white";
        div.style.fontSize = "8px";
        div.style.padding = "10px";
        div.style.zIndex = "9999";
        div.style.textAlign = "center"; // 메시지를 가운데 정렬
        div.textContent = message;

        // 각 메시지 위로 margin-top을 증가시켜서 순차적으로 아래로 쌓이게 설정
        let currentTop = parseInt(div.style.top, 10);
        const existingMessages = document.querySelectorAll('.debug-message');
        div.classList.add('debug-message');
        div.style.top = `${currentTop + existingMessages.length * 25}px`; // 각 메시지에 25px 간격을 추가

        document.body.appendChild(div);

        // 2초 후에 메시지를 삭제하는 처리
        setTimeout(() => {
            div.remove(); // 메시지 삭제
        }, 2000); // 2000ms (2초) 후에 메시지를 삭제
    };

    $(document).ready(function () {
        // 페이지 로드 시 기본 프로필 정보를 불러오는 함수 호출
        initializeProfilePage();

        // 프로필 페이지에 필요한 AJAX 요청을 처리하는 함수
        function initializeProfilePage() {
            const accessToken = localStorage.getItem('access_token');
            if (!accessToken) {
                $('.loading').text('로그인이 필요합니다.');
                return;
            }

            $.ajax({
                url: 'http://127.0.0.1:8000/api/accounts/profile/',
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + accessToken
                },
                success: function (data) {
                    $('#username').text(data.username || '없음');
                    $('#email').text(data.email || '없음');
                    $('#introduction').text(data.introduction || '없음');
                    if (data.profile_image) {
                        $('#profile-image').attr('src', data.profile_image);
                    } else {
                        $('#profile-image').attr('src', 'img/profile/default-profile.jpg');
                    }
                    $('.loading').hide();
                },
                error: function (xhr, status, error) {
                    console.error(error);
                    if (xhr.status === 401) {
                        $('.loading').text('인증 오류: 토큰이 유효하지 않습니다.');
                    } else {
                        $('.loading').text('프로필을 불러오는 데 오류가 발생했습니다.');
                    }
                }
            });
        }

        // 기본적으로 첫 번째 메뉴의 HTML을 로드하고 프로필을 불러오는 함수 호출

        // 네비게이션 메뉴 클릭 이벤트
        $('.sidebar .item').on('click', function () {
            // 1. 모든 메뉴에서 active 클래스 제거
            $('.sidebar .item').removeClass('active');

            // 2. 클릭한 메뉴에 active 클래스 추가
            $(this).addClass('active');

            // 3. 클릭한 메뉴의 data-url 속성에서 HTML 파일 경로를 가져옴
            var url = $(this).data('url');

            // 4. 해당 HTML 파일을 #content-area에 로드하고 프로필 정보도 초기화
            $('#content-area').load(url, function() {
                initializeProfilePage(); // 페이지가 로드된 후 프로필 정보를 불러오는 함수 호출
            });
        });
    });
</script>
