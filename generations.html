
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
<link rel="stylesheet" href="css/generations/styles.css" type="text/css">
<link rel="stylesheet" href="css/generations/gallery.css" type="text/css">
<link rel="stylesheet" href="css/generations/reft.css" type="text/css">
<link rel="stylesheet" href="css/generations/regeneration.css" type="text/css">
<link rel="stylesheet" href="css/generations/refresh.css" type="text/css">
<link rel="stylesheet" href="https://rr720.synology.me/paint/css/main.css" type="text/css">
<link rel="Stylesheet" type="text/css" href="https://rr720.synology.me/paint/lib/wColorPicker.min.css" />
<link rel="Stylesheet" type="text/css" href="https://rr720.synology.me/paint/wPaint.min.css" />
<link rel="stylesheet" href="css/chatbot/style.css"/>

<script src="js/generations/buttons.js" defer></script>
<script src="js/generations/image.js"></script>
<script src="js/generations/sample.js"></script>
<script src="js/generations/gallery.js" defer></script>

<style>
    /* 배경 이미지 설정을 위한 커스텀 CSS */
    body {
        background-image: url('img/bg/gbg.png'); 
        background-size: cover;           
        background-position: center;      
        background-repeat: no-repeat;     
        height: 100vh;                    
    }
</style>

<!-- first loading -->
<div class="vw-100 min-vh-100 position-fixed z-3 display-none" style="background-color: #ffffff;" id="first-loading">
    <div class="spinner-grow text-dark position-fixed top-50 start-50 translate-middle z-3" role="status"
        style="width: 4rem; height: 4rem;"></div>
</div>

<div class="bg-white opacity-75 position-fixed z-3 display-none" id="wrap-loading">
    <div class="spinner-grow text-dark position-fixed z-3" role="status"></div>
</div>
<!-- <h1 class="text-center mb-4">whyding 8조</h1> -->
<div>
    <div class="row mt-2" id="gbg">
        <section class="col-12 col-md-8 mt-2">
            <div class="accordion-body d-flex justify-content-center align-items-center">
                <!-- gallery -->
                <div class="col" id="gallery-area">
                    <div class="row" id="gal-refreshgallery-area">
                        <!-- gallery refresh -->
                        <div class="col-2 text-center">
                            <button class="btn btn-outline-dark btn-sm fw-lighter"
                                id="gal-refreshButton">Refresh</button>
                        </div>
                        <!-- gallery style -->
                        <div class="col-7 d-flex justify-content-center align-items-center">
                            <form method="post" action="" id="check-style-area">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="form-switch d-flex align-items-center">
                                        <input type="checkbox" role="switch" name="checkStyle[]" value="white" checked
                                            id="white">
                                        <label class="d-block text-dark-emphasis fw-lighter ms-2"
                                            style="cursor: default;" for="white">white</label>
                                    </div>
                                    <div class="form-switch d-flex align-items-center">
                                        <input type="checkbox" role="switch" name="checkStyle[]" value="black" checked
                                            id="black">
                                        <label for="black" class="d-block text-dark-emphasis fw-lighter ms-2"
                                            style="cursor: default;">black</label>
                                    </div>
                                    <div class="form-switch d-flex align-items-center">
                                        <input type="checkbox" role="switch" name="checkStyle[]" value="color" checked
                                            id="color">
                                        <label class="d-block text-dark-emphasis fw-lighter ms-2"
                                            style="cursor: default;" for="color">color</label>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="col-2 text-center">
                            <select class="btn btn-sm btn-outline-dark dropdown-toggle" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false" id="gal-quarter">
                                <option value="dress">드레스</option>
                                <option value="tuxedo">턱시도</option>
                            </select>
                        </div>

                    </div>
                    <!-- gallery bottom -->
                    <div id="gal-text-area"></div>
                    <div class="gallery-images">
                    </div>
                    <p class="text-center text-body-secondary fw-lighter mt-3 fs-6" id="gal-text-center">
                        위의 이미지는 인공지능 기술을 활용하여 생성된 이미지로, 실제 인물과는 관련이 없습니다.</p>
                </div>
            </div>
        </section>
        <section class="col-12 col-md-4 d-flex flex-column justify-content-center align-items-center mt-2">
            <div class="imageContainerSource col-md-4 flex-column justify-content-center align-items-center"
                style=" width: 100%;">
                <div class="image-box" id="source_image">
                    <!-- 실제 파일 입력 필드 (숨겨져 있음) -->
                    <input class="form-control-file" type="file" id="imageUploadSource" accept="image/jpeg, image/png"
                        style="display: none;">
                    <div class="error" id="errorSource"></div>

                    <!-- 미리보기 이미지 -->
                    <img src="" alt="미리보기 이미지" style="width: 20vh; border-radius: 50px; object-fit: contain;"
                        id="previewSource">

                    <div class="d-flex justify-content-center align-items-center">
                        <label class="btn btn-outline-secondary btn-sm mt-3" style="width: auto;"
                            for="imageUploadSource">
                            <i class="bi bi-file-earmark-arrow-up"></i>내 얼굴 업로드</label>
                    </div>
                </div>
            </div>

            <div class="imageContainertarget col-md-7 flex-column justify-content-center align-items-center"
                style=" width: 100%;">
                <!-- 이미지 박스 -->
                <div class="col image-box d-flex justify-content-center align-items-center" id="target_image">
                    <div id="errorTarget" class="error"></div>
                    <!-- <img id="previewTarget" src="" alt="미리보기 이미지" style="width: 25vh; display: none;"> -->
                    <img id="previewTarget" src="" alt="미리보기 이미지"
                        style="width: 20vh; height: 30vh; background-color: #ccc; border-radius: 50px;">

                    <div class="overlay-buttons row">
                        <!-- 재생성버튼 -->
                        <!-- <button class="btn btn-light btn-sm mt-2 shadow"
                            style="width: auto; min-width: 150px; height: auto; white-space: nowrap;"
                            id="gen-generateButton">
                            Regenerate
                        </button> -->
                    </div>
                </div>
                <!-- 스패너 -->
                <!-- 생성버튼 -->
                <div class="d-flex justify-content-center align-items-center">
                    <button class="btn btn-dark btn-sm "
                        style="width: auto; min-width: 150px; height: auto; white-space: nowrap; cursor: pointer; display: none;"
                        id="createImageButton">
                        착용하기
                    </button>
                    <div class="spinner-border text-dark" role="status" id="spinner">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div style="display: none;" id="gen-error-text">Please upload or select an image</div>
                    </p>
                </div>
            </div>

        </section>
    </div>
</div>
<!-- 상단: 두 이미지 조합 결과를 보여주는 영역 -->
<div class="image-result row" id="imageResult" style="display: none;">
    <div class="image-container">
        <img src="" alt="조합된 이미지" id="combinedImage">
    </div>
    <div class="button-container">
        <button id="closeButton" class="btn btn-dark btn-sm" onclick="closeResult()">닫기</button>
        <button id="SetProfile" class="btn btn-dark btn-sm">
            <i class="bi bi-file-person"></i>&nbsp;프로필 변경
        </button>
        <button id="saveButton" class="btn btn-dark btn-sm">
            <i class="bi bi-folder-plus"></i>&nbsp;보관
        </button>
        <button id="downloadButton" class="btn btn-success btn-sm" onclick="downloadImage()"><i
                class="bi bi-file-arrow-down"></i>&nbsp;다운로드</button>
    </div>

    <!-- 피드백 공간 -->
    <div class="feedback-section d-flex flex-column align-items-center mt-3">
        <!-- <p class="text-light mt-2 fs-6">피드백을 남겨주세요</p> -->
        <div class="input-container position-relative" style="width: 40%;">
            <textarea class="form-control rounded-3" style="font-size: 0.7rem" id="feedbackText" rows="4"
                placeholder="귀중한 시간을 내셔서 참여해 주신 만큼 좋은 피드백을 남겨주신 분께 추첨을 통해 상품을 드릴 예정입니다." onfocus="clearPlaceholder()"
                onblur="restorePlaceholder()"></textarea>
            <button class="btn btn-dark btn-sm position-absolute bottom-0 end-0 mb-2 me-2" id="submitFeedback"
                onclick="submitFeedback()">제출</button>
        </div>
    </div>
</div>

<div class="image-edit z-2" id="image-edit" style="display: none;">
    <!-- 프롬프트 입력 창-->
    <section class="col-12 col-md-8 mt-2">
        <div class="d-flex justify-content-center" id="accordionMain">
            <!-- 체크박스 추가 -->
            <div id="wpDrop-area-div"
                class="accordion-body d-flex flex-column justify-content-center align-items-center mt-4 mb-4"
                style="display: none; ">
                <!-- wPaint -->
                <div id="wPaint" class="dropzone"></div>
                <div id="wpBGbutton-area" class="d-flex flex-wrap justify-content-center align-items-center w-100">
                    <!-- 배경 이미지 버튼 예시 (주석처리된 부분) -->
                    <!-- <img class="wpBGbutton" src="img/wpBG/bg00.jpg"></button> -->
                </div>

            </div>
            <div class="row d-flex flex-column align-items-center justify-content-center" style="margin-top: 3.8rem;">
                <div class="mb-3" style="font-size: 0.6rem">
                    <label for="exampleFormControlTextarea1" class="form-label text-white">prompt</label>
                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="5"></textarea>
                </div>
                <div class="mb-3" style="font-size: 0.6rem">
                    <label for="exampleFormControlTextarea2" class="form-label text-white">N prompt</label>
                    <textarea class="form-control" id="exampleFormControlTextarea2" rows="3"></textarea>
                </div>
                <p class="text-white" style="font-size: 0.6rem" id="creativityText">
                    Creativity
                </p>
                <div class="d-flex justify-content-center align-items-center">
                    <button class="btn btn-sm btn-light" id="increase">+</button>
                    <input type="range" min="0.45" max="0.7" value="0.55" step="0.001" class="Denoisingslider"
                        id="DenoisingRange" style="direction: rtl;">
                    <button class="btn btn-sm btn-light" id="decrease">-</button>
                </div>
                <!-- 스피너 -->
                <div class="spinner-border text-light mt-4 mb-2" role="status" id="spinner-re" style="display: none;">
                </div>
                <div class="mt-4" id="wpButton-area">
                    <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(event)">
                    <input type="file" id="uploadInput" style="display: none;" onchange="handleFileSelect(event)">
                    <!-- <button id="wpClear" class="btn btn-sm me-2 mb-4">Image Reset</button> -->

                    <button id="wpreset" class="btn btn-outline-light btn-sm me-2 mb-4"> <i
                            class="bi bi-arrow-repeat"></i> </button>
                    <button id="wpClose" class="btn btn-outline-light  btn-sm me-2 mb-4"> 닫기 </button>
                    <button id="wpGen" class="btn btn btn-dark  btn-sm me-2 mb-4"> 생성 </button>
                    <button id="wpApp" class="btn btn-light  btn-sm me-2 mb-4"> 적용 </button>
                </div>
            </div>
        </div>

</div>


<script>
    $(document).ready(function () {
        // 페이지가 로드되면 #wrap-loading의 display-none 클래스를 제거하고, 서서히 보이게 함
        $('#wrap-loading').removeClass('display-none').fadeIn(500); // 0.5초 동안 서서히 나타남

        // 2초 후에 #wrap-loading을 서서히 숨기기
        setTimeout(function () {
            $('#wrap-loading').fadeOut(1000, function () {
                // fadeOut이 끝난 후 display-none 클래스를 추가하여 완전히 숨김
                $(this).addClass('display-none');
            });
        }, 1000); // 2초 후
    });
    $(document).ready(function () {
        var wpaintImageUrl = null
        // var ajaxBase64Image = null
        // var wpaintFi = null

    })
</script>
<script>
    // 텍스트 입력창 클릭 시 안내 문구 사라지기
    function clearPlaceholder() {
        const feedbackText = document.getElementById('feedbackText');
        // 기본 placeholder 내용이 표시될 때만 텍스트를 지움
        if (feedbackText.value === feedbackText.placeholder) {
            feedbackText.value = '';
        }
    }

    // 텍스트 입력창 클릭 후 입력하지 않으면 안내 문구 복원
    function restorePlaceholder() {
        const feedbackText = document.getElementById('feedbackText');
        // 사용자가 아무것도 입력하지 않았다면 placeholder 복원
        if (feedbackText.value === '') {
            feedbackText.value = feedbackText.placeholder;
        }
    }

    // 피드백 제출 처리 (추가 구현 필요)
    function submitFeedback() {
        const feedbackText = document.getElementById('feedbackText').value;
        if (feedbackText && feedbackText !== feedbackText.placeholder) {
            // 서버로 피드백 전송 코드 추가
            alert('피드백이 제출되었습니다!');
        } else {
            alert('피드백을 입력해주세요.');
        }
    }
</script>
<script>
    $('#gen-generateButton').click(function () {
        $('#image-edit').toggle(); // #imageResult의 display 속성을 토글 (보이기/숨기기)
        $("#wPaint").wPaint("image", wpaintImageUrl);
    });
    $('#wpClose').click(function () {
        $('#image-edit').toggle(); // #imageResult의 display 속성을 토글 (보이기/숨기기)
    });

    $('#wpreset').click(function () {
        $("#wPaint").wPaint("image", wpaintImageUrl);
    });

    $('#wpApp').click(function () {
        $('#previewTarget').attr('src', wpaintRe).show();
        imageBase64Target = wpaintFi
        $('#image-edit').toggle();
    });
</script>

<!-- <link rel="stylesheet" href="css/chatbot/style.css" /> -->
<!-- <script src="js/chatbot/script.js" defer></script> -->

<button class="chatbot-toggler">
    <span class="material-symbols-rounded">mode_comment</span>
    <span class="material-symbols-outlined">close</span>
</button>
<div class="chatbot">
    <header>
        <h2 class="mt-2">Whyding 챗봇</h2>
        <span class="close-btn material-symbols-outlined">close</span>
    </header>
    <ul class="chatbox">
        <li class="chat incoming">
            <img src="img/chatbot/ch.png" alt="smart_toy" style="width: 35px; height: 35px;">
            <p>안녕! 👋<br/>웨딩 촬영 준비에 도움을 줄게! <br/>원하는 웨딩 이미지를 올리면 적절한 프롬프트를 찾아줄게!! </p>
        </li>
    </ul>
    <div class="chat-input d-flex justify-content-center ">
        <label class="material-symbols-rounded fs-6 my-3" for="image-upload" >
            add_photo_alternate
            <span class="fs-6 my-3">이미지 업로드</span>
        </label>
        <input type="file" id="image-upload" accept="image/*" style="display: none;">
    </div>
    <style>
        /* 마우스 올리면 손가락 모양으로 변경되고, 투명도 0.5 */
        .chat-input label {
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
    
        .chat-input label:hover {
            opacity: 0.3;
        }
    </style>

<script src="js/generations/ajax.js" defer></script>
<script src="js/generations/ajax_re.js" defer></script>
<script src="js/generations/ajax_article.js" defer></script>

<!-- jQuery UI -->
<script type="text/javascript" src="https://rr720.synology.me/paint/lib/jquery.ui.core.1.10.3.min.js"></script>
<script type="text/javascript" src="https://rr720.synology.me/paint/lib/jquery.ui.widget.1.10.3.min.js"></script>
<script type="text/javascript" src="https://rr720.synology.me/paint/lib/jquery.ui.mouse.1.10.3.min.js"></script>
<script type="text/javascript" src="https://rr720.synology.me/paint/lib/jquery.ui.draggable.1.10.3.min.js"></script>
<!-- wColorPicker -->

<script type="text/javascript" src="https://rr720.synology.me/paint/lib/wColorPicker.min.js"></script>
<!-- wPaint -->
<script type="text/javascript" src="https://rr720.synology.me/paint/wPaint.min.js"></script>
<script type="text/javascript" src="https://rr720.synology.me/paint/plugins/main/wPaint.menu.main.min.js"></script>


<script src="https://rr720.synology.me/paint/js/sub.js"></script>
<script src="js/generations/edit.js"></script>
<script src="js/generations/wpaint.js"></script>

<script src="js/generations/ajax_profile_change.js" defer></script>
<script src="js/chatbot/script.js" defer></script>