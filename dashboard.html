<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whyding 8조</title>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="css/dashboard/style.css">
    <script src="js/dashboard/script.js"></script>
    <script src="js/profile/profile.js"></script>



    <script src="js/dashboard/sign_out.js"></script>
    

    <script src="js/dashboard/ranking.js"></script>
    <link rel="stylesheet" href="css/dashboard/ranking.css">


</head>

<body>

    <div class="left-section">
        <div class="logo">
            <img class="mb-3" src="img/logo.svg" style="width: 40px;" alt="Logo">
            <!-- <img class="item" src="img/logo_side.svg" style="width: 5vh;" alt="Logo"> -->
            <!-- <img src="assets/images/logo.png"> -->
            <a href="https://rr720.synology.me/whyding/">
                <img class="item" src="img/logo_side.svg" style="width: 130px;" alt="Logo">
            </a>
        </div>
        <div class="profile">
            <div class="info d-flex justify-content-start align-items-center text-center mt-3 ">
                <img id="profile-image-main" src="your-image-url.jpg"
                    style="width: 40px; height: 40px; border-radius: 10px; object-fit: cover; object-position: center;">
                <h5 class="ms-3 text-2xl" id="profile-name-main">loading..</h5>
            </div>
        </div>
        <div class="separator" style="border-bottom: 2px solid #5f5f5f; margin-top: 15px;" id="profile-underbar"></div>
        <!-- <div class="user"> -->
        <!-- <i class="ri-notification-2-line"></i> -->
        <!-- <i class="ri-user-3-line"></i> -->
        <!-- </div> -->



        <div class="sidebar mt-3">
            <div class="item active" data-url="middle.html">
                <i class="ri-home-4-line"></i>
                <h3>Dashboard</h3>
            </div>
            <div class="item" data-url="generations.html">
                <i class="ri-movie-2-line"></i>
                <h3>Generate</h3>
            </div>
            <div class="item" data-url="album.html">
                <i class="ri-user-6-line"></i>
                <h3>My Private Album</h3>
            </div>
            <div class="item" data-url="history.html">
                <i class="ri-history-line"></i>
                <h3>History</h3>
            </div>
            <div class="item" data-url="settings.html">
                <i class="ri-settings-3-line"></i>
                <h3>Settings</h3>
            </div>
            <div class="sign-out">
                <i class="ri-logout-box-r-line"></i>
                <h3>Sign Out</h3>
            </div>
        </div>



        <!-- <div class="sign-out  mt-5">
            <i class="ri-logout-box-r-line"></i>
            <h3>Sign Out</h3>
        </div> -->

    </div>

    <div class="main">
        <div class="header">
            <div class="search">
                <button><i class="ri-search-2-line"></i></button>
                <input type="text" placeholder="Search for videos...">
            </div>
            <i class="ri-equalizer-2-line"></i>
        </div>

        <div class="main-content">
            <!-- 중앙 콘텐츠가 로드될 영역 -->
            <div id="content-area">Loading...</div>
        </div>
    </div>

    <div class="right-section">

        <!-- 신부대기실 -->

        <!-- 폐백실 -->

        <h3>COURTESY ROOM</h3>

        <div class="player">
            <div class="content">
                <img src="assets/images/c001.jpg">
                <div class="info">
                    <h5>Germany Travel Tour</h5>
                    <div class="rate">
                        <i class="ri-star-fill"></i>
                        <h5>4.7</h5>
                    </div>
                </div>
                <div class="desc">
                    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Vero...</p>
                </div>
            </div>
            <i class="ri-pause-large-line"></i>
        </div>
        <!-- 주간 인기 -->
        <h3>POPULAR</h3>

        <div class="weekly">
            <div class="item" id="wItem01">
                <div class="content">
                    <img src="assets/images/w001.jpg">
                    <div class="info">
                        <h4>Sea Balloon</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>2,320</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem02">
                <div class="content">
                    <img src="assets/images/w002.jpg">
                    <div class="info">
                        <h4>Flower</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>2,490</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem03">
                <div class="content">
                    <img src="assets/images/w003.jpg">
                    <div class="info">
                        <h4>Street</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>1,420</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem04">
                <div class="content">
                    <img src="assets/images/w004.jpg">
                    <div class="info">
                        <h4>Sea Water</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>9,610</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem05">
                <div class="content">
                    <img src="assets/images/w001.jpg">
                    <div class="info">
                        <h4>Sea Balloon</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>2,320</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem06">
                <div class="content">
                    <img src="assets/images/w002.jpg">
                    <div class="info">
                        <h4>Flower</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>2,490</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem07">
                <div class="content">
                    <img src="assets/images/w003.jpg">
                    <div class="info">
                        <h4>Street</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>1,420</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
            <div class="item" id="wItem08">
                <div class="content">
                    <img src="assets/images/w004.jpg">
                    <div class="info">
                        <h4>Sea Water</h4>
                        <div class="view">
                            <i class="ri-eye-fill"></i>
                            <h5>9,610</h5>
                        </div>
                    </div>
                </div>
                <i class="ri-heart-3-fill"></i>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 페이지 로드 전에 실행될 스크립트
            (function () {
                // 로컬 스토리지에서 토큰 가져오기
                const accessToken = localStorage.getItem("access_token");
                const refreshToken = localStorage.getItem("refresh_token");

                // 디버그 메시지를 화면에 출력하는 함수
                const debugMessage = (message) => {
                    const div = document.createElement("div");
                    div.style.position = "fixed";
                    div.style.top = "10px"; // 위에서부터 차례대로 표시되게 하려면 top을 고정
                    div.style.left = "50%"; // 화면 가운데 정렬
                    div.style.transform = "translateX(-50%)"; // 가로 중앙 정렬
                    div.style.width = "100%"; // 넓이를 80%로 설정하여, 너무 길게 표시되지 않도록 함
                    div.style.backgroundColor = "rgba(0, 0, 0, 0.3)";
                    div.style.color = "white";
                    div.style.fontSize = "8px";
                    div.style.padding = "10px";
                    div.style.zIndex = "9999";
                    div.style.textAlign = "center"; // 메시지를 가운데 정렬
                    div.textContent = message;

                    // 각 메시지 위로 margin-top을 증가시켜서 순차적으로 아래로 쌓이게 설정
                    let currentTop = parseInt(div.style.top, 10);
                    const existingMessages = document.querySelectorAll('.debug-message');
                    div.classList.add('debug-message');
                    div.style.top = `${currentTop + existingMessages.length * 30}px`; // 각 메시지에 45px 간격을 추가

                    document.body.appendChild(div);

                    // 2초 후에 메시지를 삭제하는 처리
                    setTimeout(() => {
                        div.remove(); // 메시지 삭제
                    }, 2000); // 2000ms (2초) 후에 메시지를 삭제
                };

                // 화면에 토큰 정보 출력
                debugMessage("Access Token: " + accessToken);
                debugMessage("Refresh Token: " + refreshToken);

                // 3초 후 리다이렉트 함수
                const redirectToHome = () => {
                    setTimeout(() => {
                        window.location.href = "https://rr720.synology.me/whyding/";
                    }, 3000);  // 3초 후 리다이렉트
                };

                if (!accessToken || !refreshToken) {
                    // 토큰이 없는 경우 즉시 리다이렉트
                    debugMessage("토큰이 없습니다. 3초 후 리다이렉트합니다.");
                    redirectToHome();
                    return;
                }

                // 토큰 검증 요청
                const verifyToken = async () => {
                    try {
                        debugMessage("토큰 검증 요청 중...");
                        const response = await fetch("http://127.0.0.1:8000/api/accounts/token/verify/", {
                            method: "GET",  // GET 방식
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${accessToken}`  // Authorization 헤더에 Bearer 토큰 추가
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.message === "Token is valid.") {
                                debugMessage("인증 성공.");
                            } else {
                                debugMessage("인증 실패: " + JSON.stringify(data));
                                redirectToHome();
                            }
                        } else {
                            const errorData = await response.json();
                            debugMessage("인증 실패: " + JSON.stringify(errorData));
                            redirectToHome();
                        }
                    } catch (error) {
                        console.error("네트워크 오류: ", error);
                        debugMessage("네트워크 오류 발생: " + error.message);
                        redirectToHome();
                    }
                };

                // 토큰 검증 실행
                verifyToken();
            })();
        });

        // document.querySelector('.sign-out').addEventListener('click', function () {
        //     // localStorage에서 access_token과 refresh_token 삭제
        //     localStorage.removeItem('access_token');
        //     localStorage.removeItem('refresh_token');

        //     // 리다이렉트
        //     window.location.href = 'https://rr720.synology.me/whyding/';
        // });

        document.querySelector('.sign-out').addEventListener('click', function() {
            signOut(); // logout.js에 정의된 logout 함수 호출
        });

        // initializeProfilePage(); 
    </script>





    <!-- 
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 페이지 로드 전에 실행될 스크립트
            (function () {
                // 로컬 스토리지에서 토큰 가져오기
                const accessToken = localStorage.getItem("access");
                const refreshToken = localStorage.getItem("refresh");
    
                const debugMessage = (message) => {
                    // div 요소를 생성하여 디버그 메시지를 화면에 출력
                    const div = document.createElement("div");
                    div.style.position = "fixed";
                    div.style.top = "0"; // 헤더 위치에 고정
                    div.style.left = "0";
                    div.style.width = "100%";
                    div.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
                    div.style.color = "white";
                    div.style.fontSize = "14px";
                    div.style.padding = "10px";
                    div.style.zIndex = "9999";
                    div.style.textAlign = "center"; // 메시지를 가운데 정렬
                    div.textContent = message;
    
                    document.body.appendChild(div);
                };
    
                // 디버그 메시지 출력
                debugMessage("토큰 검사 시작...");
    
                // 3초 후 리다이렉트 함수
                const redirectToHome = () => {
                    setTimeout(() => {
                        window.location.href = "https://rr720.synology.me/whyding/";
                    }, 3000);  // 3초 후 리다이렉트
                };
    
                if (!accessToken || !refreshToken) {
                    // 토큰이 없는 경우 즉시 리다이렉트
                    debugMessage("토큰이 없습니다. 3초 후 리다이렉트합니다.");
                    redirectToHome();
                    return;
                }
    
                // 토큰 검증 요청
                const verifyToken = async () => {
                    try {
                        debugMessage("토큰 검증 요청 중...");
                        const response = await fetch("http://127.0.0.1:8000/api/accounts/token/verify/", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ token: accessToken }),
                        });
    
                        if (response.ok) {
                            const data = await response.json();
                            if (data.message !== "Token is valid.") {
                                // 인증 실패 시 3초 후 리다이렉트
                                debugMessage("인증 실패. 3초 후 리다이렉트합니다.");
                                redirectToHome();
                            } else {
                                debugMessage("인증 성공.");
                            }
                        } else {
                            const errorData = await response.json();
                            debugMessage("인증 실패: " + JSON.stringify(errorData));
                            redirectToHome();
                        }
                    } catch (error) {
                        console.error("네트워크 오류: ", error);
                        debugMessage("네트워크 오류 발생: " + error.message);
                        redirectToHome();
                    }
                };
    
                // 토큰 검증 실행
                verifyToken();
            })();
        });
    </script>
     -->

</body>

</html>